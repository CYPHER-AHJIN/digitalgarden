---
{"dg-publish":true,"permalink":"/soc-l1-complete-knowledge-base/11-malware/malware-basics/"}
---

# Malware Basics
#Malware #MalwareAnalysis #Forensics #SOC

---

## What is Malware?

Malware (malicious software) is any software intentionally designed to cause disruption to a computer, server, client, or network. As an SOC analyst, you won't typically do deep reverse engineering at L1, but you MUST understand malware categories, behavior, and indicators well enough to triage and escalate correctly.

**Why it matters in real SOC:** Every malware alert you get has a family name, behavioral profile, and known IOCs. Understanding malware types tells you what the attacker can do once they're in — and what to look for next.

---

## Malware Classification

### Virus
- Attaches to legitimate files and spreads when infected file is executed
- Self-replicating within files
- **Modern prevalence:** Rare in enterprise environments (most malware today is not self-replicating viruses)

### Worm
- Self-replicating, spreads across networks WITHOUT user interaction
- Exploits vulnerabilities to propagate
- **Examples:** WannaCry (EternalBlue exploit), NotPetya, Conficker
- **Detection:** Unusual lateral scanning from internal hosts

### Trojan
- Disguised as legitimate software
- Does NOT self-replicate
- Creates backdoor, steals data, downloads more malware
- **Examples:** Emotet, TrickBot, Dridex
- **Detection:** Process from unusual path, process making unexpected network connections

### Ransomware
- Encrypts files, demands payment
- Often spreads laterally before detonating
- **Attack chain:** Phishing → Trojan → Lateral Movement → Domain Admin → Ransomware deployment
- **Examples:** LockBit, Conti, ALPHV/BlackCat, REvil
- **Indicators:**
  - Mass file extension changes (.locky, .encrypted, random extension)
  - vssadmin delete shadows (shadow copy deletion)
  - Files named RANSOM_NOTE.txt or README.txt appearing everywhere
  - Canary files triggering alerts
- **Detection:**
  ```spl
  index=sysmon EventCode=1 
  CommandLine IN ("*vssadmin*delete*shadows*","*wbadmin*delete*catalog*","*bcdedit*/set*recoveryenabled*no*")
  | table _time, Computer, User, CommandLine
  ```

### Remote Access Trojan (RAT)
- Gives attacker full remote control of victim machine
- Keylogging, screenshot capture, file access, webcam
- **Examples:** njRAT, AsyncRAT, DarkComet, Quasar RAT
- **Detection:** Unexpected listening ports, unusual outbound connections, process with elevated privileges

### Rootkit
- Hides itself and other malware from detection
- Operates at kernel level (ring 0)
- Can intercept system calls, modify kernel data
- **Examples:** ZeroAccess, Necurs, UEFI rootkits
- **Detection:** Very hard to detect from within the OS. Requires:
  - Offline analysis (boot from clean USB)
  - Memory forensics (Volatility — processes visible in memory but not tasklist)
  - Integrity check against known-good system baseline

### Spyware / Keylogger
- Silently records keystrokes, screenshots, browsing
- Often embedded in legitimate-looking apps
- **Detection:** Unusual process making connections to external IPs, key logging artifacts

### Adware
- Displays unwanted ads, often bundled with free software
- Lower severity, but can be gateway for more malicious payloads

### Bootkit
- Infects Master Boot Record (MBR) or UEFI
- Loads before OS, persists across reinstalls
- **Examples:** BootHole, BlackLotus (UEFI)
- **Detection:** Impossible from within OS. Requires secure boot validation, UEFI integrity checks

### Fileless Malware
- Runs entirely in memory, no file dropped to disk
- Uses LOLBins (living-off-the-land binaries) and PowerShell
- **Examples:** Cobalt Strike, PowerShell Empire, Meterpreter in memory
- **Detection:** PowerShell script block logging (Event 4104), WMI event subscriptions, process injection indicators in EDR

### Backdoor / C2 Implant
- Provides persistent, hidden access to attacker
- **Examples:** Cobalt Strike beacon, Metasploit Meterpreter, custom implants
- **Detection:** Beaconing patterns (regular intervals to same destination), unusual outbound connections

### Botnet
- Collection of compromised machines (bots) controlled remotely
- Used for: DDoS, spam, credential stuffing, cryptocurrency mining
- **Examples:** Mirai (IoT), Emotet, Dridex
- **Detection:** Connections to botnet C2 infrastructure, participation in DDoS traffic

### Cryptominer
- Uses victim's CPU/GPU to mine cryptocurrency
- **Indicators:** High CPU/GPU utilization, connections to mining pools
- **Detection:**
  ```spl
  index=network dest_port IN (3333,4444,8333,9999)
  | lookup crypto_mining_pools dest_ip
  ```

---

## Malware Delivery Methods

| Method | Description | Common Malware |
|--------|-------------|----------------|
| Phishing email attachment | Malicious Office macro, PDF exploit, ISO file | Emotet, Qakbot |
| Phishing link | Downloads payload or harvests credentials | Most RATs |
| Drive-by download | Exploit kit on compromised website | NullSoft, RIG EK |
| Malvertising | Malicious ads that trigger exploits | Many |
| Supply chain | Malware in legitimate software updates | SolarWinds SUNBURST |
| USB drop | Physical media with autorun or social engineering | Stuxnet origin |
| Watering hole | Compromise website known target visits | APT campaigns |
| Living-off-the-Land | Using built-in OS tools, no download needed | Fileless malware |

---

## Malware Behavior Analysis

### Static Analysis (No Execution)
```bash
# File type identification
file malware.exe
file malware.doc

# Hash calculation
sha256sum malware.exe
md5sum malware.exe

# String extraction (look for URLs, IPs, registry keys, functions)
strings malware.exe | grep -E "http|ftp|\.com|\.exe"
strings malware.exe | grep -E "([0-9]{1,3}\.){3}[0-9]{1,3}"  # IP addresses
strings malware.exe | grep -iE "registry|HKEY|SOFTWARE"

# Entropy (high entropy = packed/encrypted = suspicious)
# Use: PEview, pestudio, FLOSS (FireEye Labs Obfuscated String Solver)

# PE header analysis
pefile malware.exe  # Python: pip install pefile
readpe malware.exe

# Import table (what Windows APIs does it use?)
# Look for: CreateRemoteThread, VirtualAllocEx, WriteProcessMemory → Process injection
# Look for: InternetOpen, HttpSendRequest → Network activity
# Look for: RegSetValueEx, CreateService → Persistence

# YARA scan
yara -r rules/ malware.exe
```

### Dynamic Analysis (Controlled Execution)
**ALWAYS use isolated VM/sandbox. Never run malware on your real machine.**

```bash
# Sandbox services (web-based)
# Any.run: interactive analysis
# Hybrid Analysis: behavioral + static
# Cuckoo: self-hosted sandbox

# Monitor process activity (Windows - Process Monitor)
# Monitor network activity: Wireshark + INetSim (fake internet)
# Monitor file changes: Process Monitor
# Monitor registry changes: Process Monitor or RegShot (before/after diff)

# After execution, check:
# - What processes were created?
# - What files were created/modified?
# - What registry keys were created?
# - What network connections were made?
# - What persistence mechanisms were installed?
```

---

## Key Malware Families SOC Analysts See

### Emotet
- **Type:** Trojan/Loader (delivers other malware like TrickBot, Qakbot)
- **Delivery:** Phishing email with malicious Word doc (macro) or password-protected ZIP
- **C2:** HTTP with custom protocol
- **Persistence:** Scheduled task or service
- **Detection:** Word.exe → wscript.exe or powershell.exe, then network to Emotet C2

### Cobalt Strike
- **Type:** Commercial C2 framework used by both pentesters and attackers
- **Delivery:** Usually deployed after initial access
- **Beacon:** Regular check-ins to C2, uses HTTPS, DNS, or SMB pipe
- **Detection:**
  - JA3/JA3S fingerprint matching known Cobalt Strike profiles
  - Default named pipes: `\MSSE-xxxx-server`, `\postex_*`
  - Default process injection into benign processes (svchost, notepad)
  - Malleable C2 profile artifacts

### Mimikatz
- **Type:** Credential dumping tool
- **Used for:** Dumping plaintext passwords, NTLM hashes, Kerberos tickets from memory
- **MITRE:** T1003.001 — LSASS Memory
- **Detection:**
  - Sysmon Event 10 — Process accessing lsass.exe with high access rights
  - Strings: `sekurlsa::logonpasswords`, `lsadump::dcsync`
  - AMSI detection in PowerShell

### Ransomware (Generic Pattern)
```
Initial Access → Persistence → Discovery → Lateral Movement → 
Privilege Escalation → Data Exfiltration (double extortion) → 
Shadow Copy Deletion → File Encryption → Ransom Note Drop
```

---

## Malware Artifacts to Hunt

### Windows Registry Persistence
```
HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Run
HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run
HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon (Userinit, Shell)
HKLM\SYSTEM\CurrentControlSet\Services (malicious service)
```

### File System Artifacts
```
C:\Users\*\AppData\Roaming\  — Trojan/implant common location
C:\Users\*\AppData\Local\Temp\  — Staging area
C:\ProgramData\  — Common persistence location
C:\Windows\Temp\  — Exploit staging
C:\Users\Public\  — Red flag for anything executable here
```

### Scheduled Tasks
```cmd
schtasks /query /fo LIST /v | grep -A5 "Task Name"
# Look for: Tasks running from AppData, Temp, odd names mimicking Windows tasks
```

### Services
```cmd
sc query type=all state=all
# Look for: Services with paths in AppData, Temp, or system folders with random names
```

---

## MITRE ATT&CK Malware Mapping

| Technique | ID | Common Malware |
|-----------|----|----|
| Phishing Attachment | T1566.001 | Emotet, Qakbot |
| PowerShell | T1059.001 | Cobalt Strike, Empire |
| Scheduled Task | T1053.005 | Most malware |
| Registry Run Key | T1547.001 | Most malware |
| LSASS Dump | T1003.001 | Mimikatz |
| C2 via HTTP | T1071.001 | Most RATs |
| DNS Tunneling | T1071.004 | Cobalt Strike, iodine |
| DGA | T1568.002 | Conficker, Dridex |
| Shadow Copy Delete | T1490 | All Ransomware |
| Process Injection | T1055 | Cobalt Strike, Meterpreter |
| Pass the Hash | T1550.002 | Mimikatz |

---

## Malware Analysis Tools

| Tool | Type | Use |
|------|------|-----|
| Ghidra | Static (RE) | Disassemble/decompile binaries |
| IDA Pro | Static (RE) | Professional disassembler |
| x64dbg | Dynamic (RE) | Windows debugger |
| Volatility | Memory forensics | Extract malware from RAM |
| FLOSS | Static | Extract obfuscated strings |
| PEStudio | Static | PE file analysis |
| Any.run | Sandbox | Interactive analysis |
| Cuckoo | Sandbox | Automated behavioral analysis |
| YARA | Detection | Signature-based malware detection |

---

## Related Notes
- [[SOC_L1_Complete_Knowledge_Base/10_Forensics/Forensics_Basics\|Forensics_Basics]]
- [[SOC_L1_Complete_Knowledge_Base/09_Incident_Response/SOC_Investigation_Playbooks\|SOC_Investigation_Playbooks]]
- [[SOC_L1_Complete_Knowledge_Base/09_Incident_Response/Incident_Response_Lifecycle\|Incident_Response_Lifecycle]]
- [[SOC_L1_Complete_Knowledge_Base/07_MITRE/MITRE_ATTACK_Overview\|MITRE_ATTACK_Overview]]
- [[SOC_L1_Complete_Knowledge_Base/03_Windows/Windows_Event_Logs\|Windows_Event_Logs]]
